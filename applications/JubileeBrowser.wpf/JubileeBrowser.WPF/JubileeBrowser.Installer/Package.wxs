<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="Jubilee Browser"
           Manufacturer="Jubilee Browser Team"
           Version="8.0.6.0"
           UpgradeCode="A1B2C3D4-E5F6-7890-ABCD-EF1234567890"
           Compressed="yes"
           InstallerVersion="500"
           Scope="perMachine">

    <MajorUpgrade DowngradeErrorMessage="A newer version of Jubilee Browser is already installed."
                  AllowSameVersionUpgrades="no"
                  Schedule="afterInstallInitialize" />

    <MediaTemplate EmbedCab="yes" />

    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="Jubilee Browser">
        <Component Id="MainExecutable" Guid="12345678-1234-1234-1234-123456789ABC">
          <File Id="JubileeBrowserExe" Source="$(var.SourceDir)JubileeBrowser.exe" KeyPath="yes">
            <Shortcut Id="DesktopShortcut"
                      Name="Jubilee Browser"
                      Directory="DesktopFolder"
                      WorkingDirectory="INSTALLFOLDER"
                      Icon="AppIcon.ico"
                      IconIndex="0"
                      Advertise="yes" />
            <Shortcut Id="StartMenuShortcut"
                      Name="Jubilee Browser"
                      Directory="ProgramMenuFolder"
                      WorkingDirectory="INSTALLFOLDER"
                      Icon="AppIcon.ico"
                      IconIndex="0"
                      Advertise="yes" />
          </File>
        </Component>
      </Directory>
    </StandardDirectory>

    <StandardDirectory Id="DesktopFolder" />
    <StandardDirectory Id="ProgramMenuFolder" />

    <Icon Id="AppIcon.ico" SourceFile="$(var.SourceDir)Resources\Icons\icon.ico" />

    <Feature Id="MainFeature" Title="Jubilee Browser" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentGroupRef Id="AppFilesGroup" />
    </Feature>

    <!-- WebView2 Runtime Check and Install -->
    <Property Id="WVRTINSTALLED">
      <RegistrySearch Id="WVRTInstalledSystem"
                      Root="HKLM"
                      Key="SOFTWARE\WOW6432Node\Microsoft\EdgeUpdate\Clients\{F3017226-FE2A-4295-8BDF-00C3A9A7E4C5}"
                      Name="pv"
                      Type="raw" />
      <RegistrySearch Id="WVRTInstalledUser"
                      Root="HKCU"
                      Key="Software\Microsoft\EdgeUpdate\Clients\{F3017226-FE2A-4295-8BDF-00C3A9A7E4C5}"
                      Name="pv"
                      Type="raw" />
    </Property>

    <Launch Condition="WVRTINSTALLED OR Privileged"
            Message="Microsoft Edge WebView2 Runtime is required. Please install it from https://developer.microsoft.com/en-us/microsoft-edge/webview2/" />

  </Package>

  <Fragment>
    <ComponentGroup Id="AppFilesGroup" Directory="INSTALLFOLDER">
      <Files Include="$(var.SourceDir)**\*.*">
        <Exclude Files="$(var.SourceDir)JubileeBrowser.exe" />
      </Files>
    </ComponentGroup>
  </Fragment>
</Wix>
