# DNS Configuration for hMailServer Email Infrastructure

This document outlines the required DNS records for proper email delivery with hMailServer for the Jubilee Browser / WorldWideBibleWeb platform.

## Overview

For each email domain, you need to configure:
1. **MX Records** - Direct incoming mail to your server
2. **A Record** - Point mail hostname to server IP
3. **SPF Record** - Authorize sending servers
4. **DKIM Record** - Cryptographic email signing
5. **DMARC Record** - Email authentication policy

---

## Domain: worldwidebibleweb.com

### MX Record
```
Type: MX
Host: @ (or worldwidebibleweb.com)
Value: mail.worldwidebibleweb.com
Priority: 10
TTL: 3600
```

### A Record for Mail Server
```
Type: A
Host: mail
Value: [YOUR_SERVER_IP]
TTL: 3600
```

### SPF Record
```
Type: TXT
Host: @ (or worldwidebibleweb.com)
Value: v=spf1 mx a ip4:[YOUR_SERVER_IP] include:amazonses.com ~all
TTL: 3600
```

**Note:** Replace `[YOUR_SERVER_IP]` with your actual server IP. The `include:amazonses.com` is for Amazon SES relay.

### DKIM Record
```
Type: TXT
Host: dkim._domainkey
Value: v=DKIM1; k=rsa; p=[YOUR_PUBLIC_KEY]
TTL: 3600
```

**Note:** Generate the DKIM key pair using hMailServer Administrator or OpenSSL:
```bash
openssl genrsa -out dkim.private 2048
openssl rsa -in dkim.private -pubout -out dkim.public
```

### DMARC Record
```
Type: TXT
Host: _dmarc
Value: v=DMARC1; p=quarantine; rua=mailto:dmarc@worldwidebibleweb.com; ruf=mailto:dmarc@worldwidebibleweb.com; sp=quarantine; aspf=r; adkim=r
TTL: 3600
```

---

## Domain: jubileebrowser.com

### MX Record
```
Type: MX
Host: @ (or jubileebrowser.com)
Value: mail.worldwidebibleweb.com
Priority: 10
TTL: 3600
```

**Note:** Points to the same mail server as worldwidebibleweb.com.

### SPF Record
```
Type: TXT
Host: @ (or jubileebrowser.com)
Value: v=spf1 mx a include:worldwidebibleweb.com include:amazonses.com ~all
TTL: 3600
```

### DKIM Record
```
Type: TXT
Host: dkim._domainkey
Value: v=DKIM1; k=rsa; p=[YOUR_PUBLIC_KEY]
TTL: 3600
```

### DMARC Record
```
Type: TXT
Host: _dmarc
Value: v=DMARC1; p=quarantine; rua=mailto:dmarc@jubileebrowser.com; ruf=mailto:dmarc@jubileebrowser.com; sp=quarantine; aspf=r; adkim=r
TTL: 3600
```

---

## Domain: jubileeverse.com

### MX Record
```
Type: MX
Host: @ (or jubileeverse.com)
Value: mail.worldwidebibleweb.com
Priority: 10
TTL: 3600
```

### SPF Record
```
Type: TXT
Host: @ (or jubileeverse.com)
Value: v=spf1 mx a include:worldwidebibleweb.com include:amazonses.com ~all
TTL: 3600
```

### DKIM Record
```
Type: TXT
Host: dkim._domainkey
Value: v=DKIM1; k=rsa; p=[YOUR_PUBLIC_KEY]
TTL: 3600
```

### DMARC Record
```
Type: TXT
Host: _dmarc
Value: v=DMARC1; p=quarantine; rua=mailto:dmarc@jubileeverse.com; ruf=mailto:dmarc@jubileeverse.com; sp=quarantine; aspf=r; adkim=r
TTL: 3600
```

---

## Amazon SES Configuration

If using Amazon SES as a relay, you must also:

### 1. Verify Domains in SES Console
- Go to AWS Console > SES > Verified identities
- Add each domain (worldwidebibleweb.com, jubileebrowser.com, jubileeverse.com)
- Add the DKIM CNAME records provided by AWS

### 2. SES DKIM CNAME Records (Auto-generated by AWS)
AWS will provide 3 CNAME records per domain:
```
Type: CNAME
Host: [token1]._domainkey
Value: [token1].dkim.amazonses.com

Type: CNAME
Host: [token2]._domainkey
Value: [token2].dkim.amazonses.com

Type: CNAME
Host: [token3]._domainkey
Value: [token3].dkim.amazonses.com
```

### 3. Request Production Access
- New SES accounts are in sandbox mode
- Request production access to send to any email address
- Go to AWS Console > SES > Account dashboard > Request production access

---

## PTR Record (Reverse DNS)

For best deliverability, configure a PTR record for your server IP:

```
Type: PTR
IP: [YOUR_SERVER_IP]
Value: mail.worldwidebibleweb.com
```

**Note:** PTR records are configured through your hosting provider, not your DNS registrar.

---

## Verification Commands

### Test MX Record
```bash
nslookup -type=mx worldwidebibleweb.com
```

### Test SPF Record
```bash
nslookup -type=txt worldwidebibleweb.com
```

### Test DKIM Record
```bash
nslookup -type=txt dkim._domainkey.worldwidebibleweb.com
```

### Test DMARC Record
```bash
nslookup -type=txt _dmarc.worldwidebibleweb.com
```

### Send Test Email
Use the hMailServer Administrator or send a test email to:
- check-auth@verifier.port25.com (returns authentication results)
- mail-tester.com (comprehensive test)

---

## Firewall Ports

Ensure these ports are open on your server:

| Port | Protocol | Service | Direction |
|------|----------|---------|-----------|
| 25   | TCP      | SMTP    | Inbound   |
| 465  | TCP      | SMTPS   | Inbound   |
| 587  | TCP      | Submission | Inbound |
| 110  | TCP      | POP3    | Inbound   |
| 995  | TCP      | POP3S   | Inbound   |
| 143  | TCP      | IMAP    | Inbound   |
| 993  | TCP      | IMAPS   | Inbound   |

---

## Troubleshooting

### Emails Going to Spam
1. Check SPF, DKIM, and DMARC records are configured
2. Verify PTR record matches mail server hostname
3. Check if server IP is on any blacklists (mxtoolbox.com/blacklists)
4. Ensure proper authentication with SES relay

### Connection Refused
1. Verify hMailServer service is running
2. Check Windows Firewall rules
3. Verify port 25 is not blocked by ISP

### SES Relay Issues
1. Check SMTP credentials are correct
2. Verify sender addresses are verified in SES
3. Check SES sending quotas

---

## Quick Reference: Environment Variables

Add these to your application's environment configuration:

```env
# SMTP Configuration
SMTP_HOST=mail.worldwidebibleweb.com
SMTP_PORT=587
SMTP_USERNAME=noreply@worldwidebibleweb.com
SMTP_PASSWORD=<secure_password>
SMTP_FROM_EMAIL=noreply@worldwidebibleweb.com

# Amazon SES Relay (if using)
SES_SMTP_ENDPOINT=email-smtp.us-east-1.amazonaws.com
SES_SMTP_USERNAME=<ses_smtp_username>
SES_SMTP_PASSWORD=<ses_smtp_password>
```
